####################################################################
#
# Makefile for the IeeeCC754 suite
# Generated by heil at Thu Jul 10 12:01:06 CEST 2003
# Edited some time later, ugly yet effective
#
# Compiler:           g++
# Math lib directory:
# Math include directory: -I..  <- here be dragons
# Platform:           fltcalc
# Target:             BasicOperations
#
####################################################################


CXX=g++
CC=gcc

CXXFLAGS=-Iinclude -Wall -g

PLATFORMLIBDIR=
PLATFORM=fltcalc
DEFINES= -DIntelPentium

SOURCES=src/bitstring.cc src/fp.cc src/hex.cc src/IeeeCC754.cc
OBJECTS=src/bitstring.o src/fp.o src/hex.o src/IeeeCC754.o

TYPE=BasicOperations
TYPEDIR=BasicOp

SOFTWARE=FLTCALC_TEST
SOFTWAREINCDIR=-I..

BasicOperations=${TYPEDIR}/${PLATFORM}/fpenv_fltcalc.o \
                  ${TYPEDIR}/${PLATFORM}/BasicOptest.o

all: IeeeCC754

IeeeCC754: ${OBJECTS} strcalc.o fltcalc.o ${${TYPE}}
	g++ -oIeeeCC754 src/IeeeCC754.o src/fp.o src/hex.o src/bitstring.o BasicOp/fltcalc/fpenv_fltcalc.o BasicOp/fltcalc/BasicOptest.o fltcalc.o strcalc.o

%.o:../%.c
	${CC} ${DEFINES} ${CFLAGS} -c -o $@ $<
.cc.o:
	${CXX} ${DEFINES} -D${TYPE} -D${SOFTWARE} -c ${CXXFLAGS} ${SOFTWAREINCDIR} -o $@ $<

clean:
	-rm -f IeeeCC754
	-rm -f ${OBJECTS} ${${TYPE}} fltcalc.o strcalc.o
	-rm -f add.log multiply.log divide.log

test: all
	./IeeeCC754 -d -f add.log -c BasicOp/testsets/add > /dev/null
	./IeeeCC754 -d -f multiply.log -c BasicOp/testsets/multiply > /dev/null
	./IeeeCC754 -d -f divide.log -c BasicOp/testsets/divide > /dev/null
	@grep "sign\|exponent\|mantissa" add.log multiply.log divide.log && echo Test failed! || true

.SUFFIXES: .c .o
