# Hey Emacs, this is a -*- makefile -*-
#
# libFIRM Project
#
# $Id$
#

top_srcdir = @top_srcdir@
srcdir = @srcdir@
topdir = ..
subdir = testprograms

DIFF ?= diff

SOURCEPATH = @top_srcdir@/firmjni/testprograms/

SOURCES := Makefile.in \
	Empty.java IfElseExample.java

MYCLASSPATH = $(CLASSPATH):../..

LD_LIBRARY_PATH += $srcdir/firmjni

run_bin_EXAMPLES = java -cp $(MYCLASSPATH) -Djava.library.path=$(topdir) Empty; \
	java -cp $(MYCLASSPATH) -Djava.library.path=$(topdir) IfElseExample

%.class: $(top_srcdir)/firmjni/testprograms/%.java
	javac -d . $<

all: 	empty ifelseexample

# bad hack ;-(
empty:
	javac -classpath $(MYCLASSPATH) -d . $(SOURCEPATH)Empty.java

ifelseexample:
	javac -classpath $(MYCLASSPATH) -d . $(SOURCEPATH)IfElseExample.java

test:   realclean all
	($(run_bin_EXAMPLES))>results.txt
	($(DIFF) results.txt $(SOURCEPATH)/run-results.txt) || (echo Firmjni test failed; exit 1)
	@echo Firmjni test successful

reference: realclean all
	($(run_bin_EXAMPLES))>$(SOURCEPATH)/run-results.txt


run:	empty ifelseexample
	java -cp $(MYCLASSPATH) -Djava.library.path=$(topdir) Empty
	java -cp $(MYCLASSPATH) -Djava.library.path=$(topdir) IfElseExample

clean:
	-rm *.class results.txt

realclean:	clean
	-rm *.vcg
